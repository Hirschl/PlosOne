*STEP 6C - CREATE CALCULATED YEAR OF BIRTH VARIABLE - HYBRID YEAR OF BIRTH;

LIBNAME PSID "U:\1Projects\PSID\WAVE37\WORKFILES";


DATA CALCYOB
(KEEP =
ER30001
ER30002
CALCYOB1968
CALCYOB1969
CALCYOB1970
CALCYOB1971
CALCYOB1972
CALCYOB1973
CALCYOB1974
CALCYOB1975
CALCYOB1976
CALCYOB1977
CALCYOB1978
CALCYOB1979
CALCYOB1980
CALCYOB1981
CALCYOB1982
CALCYOB1983
CALCYOB1984
CALCYOB1985
CALCYOB1986
CALCYOB1987
CALCYOB1988
CALCYOB1989
CALCYOB1990
CALCYOB1991
CALCYOB1992
CALCYOB1993
CALCYOB1994
CALCYOB1995
CALCYOB1996
CALCYOB1997
CALCYOB1999
CALCYOB2001
CALCYOB2003
CALCYOB2005
CALCYOB2007
CALCYOB2009
CALCYOB2011
);
SET PSID.HOUSEHOLDHEADSELECTEDVARSWLTH; 

IF AGE1968 NE . THEN CALCYOB1968=1968-AGE1968;
IF AGE1969 NE . THEN CALCYOB1969=1969-AGE1969;
IF AGE1970 NE . THEN CALCYOB1970=1970-AGE1970;
IF AGE1971 NE . THEN CALCYOB1971=1971-AGE1971;
IF AGE1972 NE . THEN CALCYOB1972=1972-AGE1972;
IF AGE1973 NE . THEN CALCYOB1973=1973-AGE1973;
IF AGE1974 NE . THEN CALCYOB1974=1974-AGE1974;
IF AGE1975 NE . THEN CALCYOB1975=1975-AGE1975;
IF AGE1976 NE . THEN CALCYOB1976=1976-AGE1976;
IF AGE1977 NE . THEN CALCYOB1977=1977-AGE1977;
IF AGE1978 NE . THEN CALCYOB1978=1978-AGE1978;
IF AGE1979 NE . THEN CALCYOB1979=1979-AGE1979;
IF AGE1980 NE . THEN CALCYOB1980=1980-AGE1980;
IF AGE1981 NE . THEN CALCYOB1981=1981-AGE1981;
IF AGE1982 NE . THEN CALCYOB1982=1982-AGE1982;
IF AGE1983 NE . THEN CALCYOB1983=1983-AGE1983;
IF AGE1984 NE . THEN CALCYOB1984=1984-AGE1984;
IF AGE1985 NE . THEN CALCYOB1985=1985-AGE1985;
IF AGE1986 NE . THEN CALCYOB1986=1986-AGE1986;
IF AGE1987 NE . THEN CALCYOB1987=1987-AGE1987;
IF AGE1988 NE . THEN CALCYOB1988=1988-AGE1988;
IF AGE1989 NE . THEN CALCYOB1989=1989-AGE1989;
IF AGE1990 NE . THEN CALCYOB1990=1990-AGE1990;
IF AGE1991 NE . THEN CALCYOB1991=1991-AGE1991;
IF AGE1992 NE . THEN CALCYOB1992=1992-AGE1992;
IF AGE1993 NE . THEN CALCYOB1993=1993-AGE1993;
IF AGE1994 NE . THEN CALCYOB1994=1994-AGE1994;
IF AGE1995 NE . THEN CALCYOB1995=1995-AGE1995;
IF AGE1996 NE . THEN CALCYOB1996=1996-AGE1996;
IF AGE1997 NE . THEN CALCYOB1997=1997-AGE1997;
IF AGE1999 NE . THEN CALCYOB1999=1999-AGE1999;
IF AGE2001 NE . THEN CALCYOB2001=2001-AGE2001;
IF AGE2003 NE . THEN CALCYOB2003=2003-AGE2003;
IF AGE2005 NE . THEN CALCYOB2005=2005-AGE2005;
IF AGE2007 NE . THEN CALCYOB2007=2007-AGE2007;
IF AGE2009 NE . THEN CALCYOB2009=2009-AGE2009;
IF AGE2011 NE . THEN CALCYOB2011=2011-AGE2011;
RUN;

PROC FREQ DATA = CALCYOB;
TABLE AGE1968--AGE2011;
RUN;

PROC TRANSPOSE DATA = CALCYOB OUT = CALCINDIVYOB (RENAME = (COL1 = CALCINDIVYOB));
BY ER30001 ER30002;
RUN;

PROC FREQ DATA = CALCINDIVYOB;
TABLE CALCINDIVYOB;
RUN;

***NOTE!!!: FOR WAVES 1968-1997, AGE MAY STAY THE SAME OR INCREASE BY 1 OR 2 FOR TWO CONSECUTIVE WAVES.  AGE CANNOT STAY THE SAME FOR 3 CONSECUTIVE YEARS.
			FOR WAVES 1997-2011, AGE MAY INCREASE BY 1 TO 3 FOR TWO CONSECUTIVE WAVES;

DATA CALCINDIVYOB2;
SET  CALCINDIVYOB;
IF CALCINDIVYOB IN (.) THEN DELETE;
RUN;

PROC FREQ DATA = CALCINDIVYOB2;
TABLE CALCINDIVYOB;
RUN;

PROC SQL;
CREATE TABLE CALCINDIVYOB3 AS
SELECT ER30001, ER30002, CALCINDIVYOB, COUNT(*) AS NUMOBS
FROM CALCINDIVYOB2
GROUP BY ER30001, ER30002, CALCINDIVYOB
ORDER BY ER30001, ER30002, NUMOBS DESC  ; 
QUIT;

ODS GRAPHICS OFF;
ODS HTML CLOSE;
ODS LISTING;

PROC FREQ DATA = CALCINDIVYOB3;
TABLE CALCINDIVYOB;
RUN;

/*select year of birth.  if individual has more than one year of birth across wave, choose the most frequently entered/used */

DATA PSID.CALCINDIVYOBWLTH (DROP = NUMOBS);
SET CALCINDIVYOB3;
BY ER30001 ER30002 DESCENDING NUMOBS;
IF FIRST.ER30001 OR FIRST.ER30002;
RUN;

*73,251 OBSERVATIONS WITH CALUCLATED YEAR OF BIRTH VALUES.  This is 100.00 percent of the total (73,251) individuals;

PROC FREQ DATA = PSID.CALCINDIVYOBWLTH; 
TABLE CALCINDIVYOB ;
RUN;

*However, there were ages that were unknown and coded 999, this results in some calculate year of birth values way below 1871, so they have to be removed.;

DATA PSID.CALCINDIVYOBWLTH;
SET PSID.CALCINDIVYOBWLTH;
IF CALCINDIVYOB < 1871 THEN DELETE;
RUN;

*NOTE: There were 73251 observations read from the data set PSID.CALCINDIVYOBWLTH.;
*NOTE: The data set PSID.CALCINDIVYOBWLTH has 73138 observations and 3 variables.;
*This means 113 individuals were removed because they have unknnown age value which was used to calculate the calculate year of birth variable;

DATA PSID.HOUSEHOLDHEADSELECTEDVARSWLTH;
MERGE PSID.HOUSEHOLDHEADSELECTEDVARSWLTH PSID.CALCINDIVYOBWLTH;
BY ER30001 ER30002;
LABEL CALCINDIVYOB = "Calculated Year of Birth of the individual";
RUN;


DATA PSID.HOUSEHOLDHEADSELECTEDVARSWLTH;
SET PSID.HOUSEHOLDHEADSELECTEDVARSWLTH;
YOBDIFFERENCE = INDIVYEAROFBIRTH - CALCINDIVYOB;
HYBRID_INDIVYEAROFBIRTH = INDIVYEAROFBIRTH;
IF HYBRID_INDIVYEAROFBIRTH = . THEN HYBRID_INDIVYEAROFBIRTH = CALCINDIVYOB;
RUN;

PROC FREQ DATA = PSID.HOUSEHOLDHEADSELECTEDVARSWLTH;
TABLE YOBDIFFERENCE HYBRID_INDIVYEAROFBIRTH;
RUN;


*RESULTS:  73,251 OBSERVATIONS LEFT;


/*OPTIONAL -- find individuals with multiple year of birth*/


/*
PROC SQL;
CREATE TABLE PSID.INDIVYEAROFBIRTH2DUPLICATES AS
SELECT A.*, B.DUPNO 
FROM INDIVYEAROFBIRTH2 A, (SELECT ER30001, ER30002, COUNT(*) AS DUPNO FROM INDIVYEAROFBIRTH2 GROUP BY ER30001, ER30002 ) B
WHERE A.ER30001 = B.ER30001 AND A.ER30002 = B.ER30002 AND DUPNO > 1
ORDER BY ER30001, ER30002;
QUIT;

PROC PRINT DATA = CALCINDIVYOB;
VAR ER30001 ER30002 CALCINDIVYOB;
WHERE CALCINDIVYOB NE . AND CALCINDIVYOB < 1871;
RUN;


DATA CALCYOBCK
(KEEP =
ER30001
ER30002
AGE1968
AGE1969
AGE1970
AGE1971
AGE1972
AGE1973
AGE1974
AGE1975
AGE1976
AGE1977
AGE1978
AGE1979
AGE1980
AGE1981
AGE1982
AGE1983
AGE1984
AGE1985
AGE1986
AGE1987
AGE1988
AGE1989
AGE1990
AGE1991
AGE1992
AGE1993
AGE1994
AGE1995
AGE1996
AGE1997
AGE1999
AGE2001
AGE2003
AGE2005
AGE2007
AGE2009
AGE2011
);
SET PSID.HOUSEHOLDHEADSELECTEDVARSWLTH; 
RUN;'

*/
