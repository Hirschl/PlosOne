*STEP 6A - CREATE INDIVIDUAL RACE VARIABLE;

LIBNAME PSID "U:\1Projects\PSID\WAVE37\WORKFILES";




DATA INDIVRACE
(KEEP =
ER30001
ER30002
RACEA1968
RACEA1969
RACEA1970
RACEA1971
RACEA1972
RACEA1973
RACEA1974
RACEA1975
RACEA1976
RACEA1977
RACEA1978
RACEA1979
RACEA1980
RACEA1981
RACEA1982
RACEA1983
RACEA1984
RACEA1985
RACEA1986
RACEA1987
RACEA1988
RACEA1989
RACEA1990
RACEA1991
RACEA1992
RACEA1993
RACEA1994
RACEA1995
RACEA1996
RACEA1997
RACEA1999
RACEA2001
RACEA2003
RACEA2005
RACEA2007
RACEA2009
RACEA2011);
SET PSID.HOUSEHOLDHEADSELECTEDVARSWLTH; 

RUN;


PROC FREQ DATA = INDIVRACE;
TABLE RACEA1968--RACEA2011;
RUN;

PROC TRANSPOSE DATA = INDIVRACE OUT = RACEINDIV (RENAME = (COL1 = INDIVRACE));
BY ER30001 ER30002;
RUN;

PROC FREQ DATA = RACEINDIV;
TABLE INDIVRACE;
RUN;


DATA INDIV_RACE;
SET  RACEINDIV;
IF INDIVRACE IN (.) THEN DELETE;
RUN;

PROC FREQ DATA = INDIV_RACE;
TABLE INDIVRACE;
RUN;


PROC SQL;
CREATE TABLE INDIV_RACE1 AS
SELECT ER30001, ER30002, INDIVRACE, COUNT(*) AS NUMOBS
FROM INDIV_RACE
GROUP BY ER30001, ER30002, INDIVRACE
ORDER BY ER30001, ER30002, NUMOBS DESC  ; 
QUIT;

PROC SORT DATA = INDIV_RACE1 OUT = INDIV_RACE2;
BY ER30001 ER30002 DESCENDING NUMOBS;
RUN;

ODS GRAPHICS OFF;
ODS HTML CLOSE;
ODS LISTING;

PROC FREQ DATA = INDIV_RACE2;
TABLE INDIVRACE;
RUN;

DATA PSID.INDIV_RACE_WLTH (DROP = NUMOBS);
SET INDIV_RACE2;
BY ER30001 ER30002 DESCENDING NUMOBS;
IF FIRST.ER30001 OR FIRST.ER30002;
RUN;

/*
NOTE: There were 81414 observations read from the data set WORK.INDIV_RACE2.
NOTE: The data set PSID.INDIV_RACE_WLTH has 73251 observations and 3 variables.
NOTE: DATA statement used (Total process time):

*/

PROC FREQ DATA = PSID.INDIV_RACE_WLTH; 
TABLE INDIVRACE ;
RUN;

*MERGE INDIVRACE TO PSID.HOUSEHOLDHEADSELECTEDVARSWLTH;

DATA PSID.HOUSEHOLDHEADSELECTEDVARSWLTH;
MERGE PSID.HOUSEHOLDHEADSELECTEDVARSWLTH PSID.INDIV_RACE_WLTH;
BY ER30001 ER30002;
*LABEL VAR INDIVRACE = "Frequently cited Race of the individual across all waves";
RUN;
/*

NOTE: There were 73251 observations read from the data set PSID.HOUSEHOLDHEADSELECTEDVARSWLTH.
NOTE: There were 73251 observations read from the data set PSID.INDIV_RACE_WLTH.
NOTE: The data set PSID.HOUSEHOLDHEADSELECTEDVARSWLTH has 73251 observations and 2434
      variables.
*/






/*OPTIONAL -- find individuals with multiple RACEs*/


/*
PROC SQL;
CREATE TABLE INDIVRACE2DUPLICATES AS
SELECT A.*, B.DUPNO 
FROM INDIV_RACE2 A, (SELECT ER30001, ER30002, COUNT(*) AS DUPNO FROM INDIV_RACE2 GROUP BY ER30001, ER30002 ) B
WHERE A.ER30001 = B.ER30001 AND A.ER30002 = B.ER30002 AND DUPNO > 1
ORDER BY ER30001, ER30002;
QUIT;

*/
